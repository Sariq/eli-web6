/*
  filename: angular.integralui.min.js
  version : 1.1.0
  Copyright © 2014 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui",[]).factory("IntegralUIDataService",function(){return function(f){if(!f)return null;var e=f,b="id",a="pid",c="items";this.updateDataFields=function(g){g&&(b=g.id?g.id:"id",a=g.pid?g.pid:"pid",c=g.objects?g.objects:"items")};this.updateDataFields(e.fields);this.update=function(a){a&&(e=a,this.updateDataFields(e.fields))};var d=angular.isDefined(e.objects);this.clear=function(a,h){var b=this.getList(a);0<b.length&&e.events&&e.events.clear({e:{parent:a}});b.length=0;h&&h()};this.insertAt=function(a,h,b,c){this.insert(a,h,b,null,!1,c)};this.insert=function(g,h,c,k,m,f){d&&!1!==(e.events?e.events.objAdding({e:{obj:g}}):!0)&&g&&(g[a]=c?c[b]:"",c=this.getList(c),0>h||null===h||void 0===h?c.push(g):(h=Math.max(Math.min(h,c.length),0),c.splice(h,0,g)),g[b]||(g[b]=this.getUniqueId()),e.events&&e.events.objAdded({e:{obj:g}}),f&&f())};this.insertByRef=function(a,h,b,c){if(d&&a&&h){var e=this.getParent(h),f=this.getList(e),f=this.getIndexOf(h,f);b&&(f+=1);this.insert(a,f,e,h,b,c);return f}};this.removeAt=function(g,b,c,k){if(d){var f=null;g&&(c=this.getParent(g),f=this.getList(c),b=this.getIndexOf(g,f));if(null===b||void 0===b)return!1;f=this.getList(c);if(0<=b&&b<f.length&&(g=f[b],!1!==(e.events?e.events.objRemoving({e:{obj:g}}):!0)))return g[a]="",f.splice(b,1),e.events&&e.events.objRemoved({e:{obj:g}}),k&&k(f,b,c),!0}return!1};this.isIndexinRange=function(a){return d&&0<=a&&a<e.objects.length?!0:!1};this.moveObject=function(a,b){d&&this.isIndexinRange(a)&&this.isIndexinRange(b)&&e.objects.splice(b,0,e.objects.splice(a,1)[0])};this.getNewIndex=function(a,b,c){if(d&&a&&b)return a=this.getParent(b),a=this.getList(a),b=this.getIndexOf(b,a),c&&(b+=1),b};this.getObjectByIndex=function(a){return d&&this.isIndexinRange(a)?e.objects[a]:null};this.findObjectById=function(a){return a?l(e.objects,a):null};var l=function(a,h){var e=null;if(a&&h)for(var d=0,f=!1;!e&&d<a.length;)a[d][b]&&(f=a[d][b].toString()===h.toString()),e=f?a[d]:l(a[d][c],h),d++;return e};this.getIndexOf=function(a,c){var e=-1;c||(c=this.getList());if(a&&c)for(var d=0;d<c.length;d++)if(c[d][b]&&a[b]&&c[d][b].toString()===a[b].toString()){e=d;break}return e};this.getList=function(a){return a?(a[c]||(a[c]=[]),a[c]):e.objects};this.findParent=function(e,d){var f=null;if(e&&d)for(var k=0;!f&&k<d.length;)f=d[k][b]&&e[a]&&d[k][b].toString()===e[a].toString()?d[k]:this.findParent(e,d[k][c]),k++;return f};this.getParent=function(a){return a?this.findParent(a,e.objects):null};this.getUniqueId=function(a){function b(){return(65536*(1+Math.random())|0).toString(16).substring(1)}a=a||"-";return b()+b()+a+b()+a+b()+a+b()+a+b()+b()+b()}}}).factory("IntegralUIDragDrop",function(){var f={dropPos:-1,source:null,sourceCtrl:null,target:null,type:""},e=function(b,a,c){return b>=c.left&&b<=c.right&&a>=c.top&&a<=c.bottom?!0:!1};return{clearData:function(){f={dropPos:-1,source:null,sourceCtrl:null,target:null,type:""}},getData:function(){return f},setData:function(b){b&&(isNaN(b.dropPos)||(f.dropPos=b.dropPos),b.source&&(f.source=b.source),b.sourceCtrl&&(f.sourceCtrl=b.sourceCtrl),b.target&&(f.target=b.target),b.type&&(f.type=b.type))},hitTest:function(b,a,c){return e(b,a,c)},getDropPos:function(b,a,c,d){if(c)a:{c={left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height};if("horizontal"===d){c.right=a.x+a.width/2;if(e(b.x,b.y,c)){b=1;break a}c.left=c.right;c.right=a.x+a.width}else{c.bottom=a.y+a.height/2;if(e(b.x,b.y,c)){b=1;break a}c.top=c.bottom;c.bottom=a.y+a.height}b=e(b.x,b.y,c)?2:-1}else"horizontal"===d?(d={left:a.x+a.width/4,top:a.y,right:a.x+3*a.width/4,bottom:a.y+a.height},e(b.x,b.y,d)?b=0:(d.right=d.left,d.left=a.x,e(b.x,b.y,d)?b=1:(d.left=a.x+3*a.width/4,d.right=a.x+a.width,b=e(b.x,b.y,d)?2:-1))):(d={left:a.x,top:a.y+a.height/4,right:a.x+a.width,bottom:a.y+3*a.height/4},e(b.x,b.y,d)?b=0:(d.bottom=d.top,d.top=a.y,e(b.x,b.y,d)?b=1:(d.top=a.y+3*a.height/4,d.bottom=a.y+a.height,b=e(b.x,b.y,d)?2:-1)));return b}}}).factory("IntegralUIInternalService",["$rootScope","$window",function(f,e){var b=null;return{getCtrl:function(a){f.$broadcast(a+"-get-ctrl");a=this.getTempData();this.clearTempData();return a?a:null},getUniqueId:function(a){function b(){return(65536*(1+Math.random())|0).toString(16).substring(1)}a=a||"-";return b()+b()+a+b()+a+b()+a+b()+a+b()+b()+b()},isEnabled:function(a){return a||void 0===a?!0:!1},isEqual:function(a,b){return a&&b?a.toString()===b.toString():!1},isSelected:function(a){return a&&a.selected?!0:!1},clearTempData:function(){b=null},getTempData:function(){return b},setTempData:function(a){b=a},getMousePos:function(a){return{x:a.pageX?a.pageX:a.originalEvent?a.originalEvent.pageX:0,y:a.pageY?a.pageY:a.originalEvent?a.originalEvent.pageY:0}},getClientMousePos:function(a,b){if(a&&b){b=angular.element(b);var d=b[0].getBoundingClientRect(),f=angular.element(e)[0].pageXOffset,g=angular.element(e)[0].pageYOffset,h=this.getMousePos(a);h.x-=d.left+f;h.y-=d.top+g;return h}return{x:0,y:0}},getPageRect:function(a){if(a){a=angular.element(a);a=a[0].getBoundingClientRect();var b=angular.element(e)[0].pageXOffset,d=angular.element(e)[0].pageYOffset;a.left-=b;a.top-=d;a.right=a.left+a.width;a.bottom=a.top+a.height;return a}return{left:0,top:0,right:0,bottom:0}}}}]);